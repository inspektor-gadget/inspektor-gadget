---
title: 'Using snapshot socket'
sidebar_position: 0
description: |
  Gather information about TCP and UDP sockets.
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

The `snapshot_socket` gadget gathers information about TCP and UDP sockets, providing visibility into network connections at the socket level.

## Use Cases

1. **Network Service Discovery**
   - Identify all listening services and their associated ports
   - Map network topology by understanding service communications

2. **Troubleshooting**
   - Verify service bindings and diagnose connection issues
   - Identify unauthorized or unexpected listening ports

3. **Security Auditing**
   - Detect unusual connection patterns
   - Verify network isolation between namespaces

4. **Capacity Planning**
   - Monitor connection counts and states
   - Identify services needing scaling based on metrics

## Getting started

Running the gadget:

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        ```bash
        $ kubectl gadget run ghcr.io/inspektor-gadget/gadget/snapshot_socket:%IG_TAG% [flags]
        ```
    </TabItem>

    <TabItem value="ig" label="ig">
        ```bash
        $ sudo ig run ghcr.io/inspektor-gadget/gadget/snapshot_socket:%IG_TAG% [flags]
        ```
    </TabItem>
</Tabs>

## Guide

### Basic Usage

Run the gadget to see all sockets in the system:

<Tabs groupId="env">
<TabItem value="kubectl-gadget" label="kubectl gadget">
```bash
# Monitor all sockets in the cluster
kubectl gadget snapshot socket

# Example output:
# NAMESPACE  POD               CONTAINER  PROTO  LOCAL  REMOTE  STATUS  
# default    nginx-pod        nginx      TCP    80     0.0.0.0:0  LISTEN  
# kube-system kube-dns-xxxxx  dnsmasq    UDP    53    0.0.0.0:0   LISTEN
```
</TabItem>

<TabItem value="ig" label="ig">
```bash
# Monitor all sockets on the host
sudo ig snapshot socket
```
</TabItem>
</Tabs>

### Common Examples

1. **Monitor a specific namespace**:
   ```bash
   kubectl gadget snapshot socket -n kube-system
   ```

2. **Filter by protocol**:
   ```bash
   # Show only TCP sockets
   kubectl gadget snapshot socket --proto tcp
   
   # Show only UDP sockets
   kubectl gadget snapshot socket --proto udp
   ```

3. **Show container socket details**:
   ```bash
   # For a specific pod
   kubectl gadget snapshot socket -p nginx-pod
   
   # With container name
   kubectl gadget snapshot socket -p nginx-pod -c nginx
   ```

### Advanced Usage

Monitor socket changes in real-time:

```bash
# Watch for socket changes with 2s refresh
kubectl gadget snapshot socket -w 2s
```

Show extended socket information:

```bash
# Include process information
kubectl gadget snapshot socket -o wide
```

<Tabs groupId="env">
<TabItem value="kubectl-gadget" label="kubectl gadget">
```bash
$ kubectl gadget run snapshot_socket:%IG_TAG%
K8S.NODE            K8S.NAMESPACE         K8S.PODNAME           K8S.CONTAINERNAME     SRC                        DST                        STATE
minikube-docker     default               test-snapshot-socket  test-snapshot-socket  :::80                      :::0                       10
minikube-docker     default               test-snapshot-socket  test-snapshot-socket  0.0.0.0:80                 0.0.0.0:0                  10
^C
```

</TabItem>

<TabItem value="ig" label="ig">
```bash
$ sudo ig run snapshot_socket:%IG_TAG% -c test-snapshot-socket
RUNTIME.CONTAINERNAME              SRC                                           DST                                          STATE
test-snapshot-socket               :::80                                         :::0                                         10
test-snapshot-socket               0.0.0.0:80                                    0.0.0.0:0                                    10
^C
```
</TabItem>
</Tabs>

Finally, clean the system:

<Tabs groupId="env">
<TabItem value="kubectl-gadget" label="kubectl gadget">
```bash
$ kubectl delete pod test-snapshot-socket
```
</TabItem>

<TabItem value="ig" label="ig">
```bash
$ docker rm -f test-snapshot-socket
```
</TabItem>
</Tabs>
