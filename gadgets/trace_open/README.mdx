---
title: trace_open
sidebar_position: 120
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# trace_open

The trace_open gadget emits events when files are opened.

## Getting started

Running the gadget:

<Tabs groupId="env">
  <TabItem value="kubectl-gadget" label="kubectl gadget">
```bash
$ kubectl gadget run ghcr.io/inspektor-gadget/gadget/trace_open:latest [flags]
```
  </TabItem>

  <TabItem value="ig" label="ig">
```bash
$ sudo ig run ghcr.io/inspektor-gadget/gadget/trace_open:latest [flags]
```
  </TabItem>
</Tabs>
## Flags

### `--failed`

Show only failed events

Default value: "false"

### `--pid`

Show only events generated by processes with this pid. By default events from all pids are traced.

### `--uid`

Show only events generated by processes with this uid. By default events from all uids are traced.

## Guide

This example shows how to use this gadget.

First, we need to run an application that generates some events.

<Tabs groupId="env">
  <TabItem value="kubectl-gadget" label="kubectl gadget">
```bash
$ kubectl run --restart=Never --image=busybox mypod -- sh -c 'while /bin/true ; do whoami ; sleep 3 ; done'
pod/mypod created
```
  </TabItem>

  <TabItem value="ig" label="ig">
```bash
$ docker run --name test-trace-open -d busybox /bin/sh -c 'while /bin/true ; do whoami ; sleep 3 ; done'
```
  </TabItem>
</Tabs>

Then, let's run the gadget:

<Tabs groupId="env">
  <TabItem value="kubectl-gadget" label="kubectl gadget">
Using the trace_open gadget, we can see which processes open what files.
We can simply filter for the pod "mypod" and omit specifying the node,
thus tracing on all nodes for a pod called "mypod":

```bash
$ kubectl gadget run trace_open:latest --podname mypod
K8S.NAMESPACE K8S.PODNAME   K8S.CONTAINE… COMM        PID     TID      UID      GID  FD FNAME                    MODE    K8S.NO… ERROR TIMESTAMP
default       mypod         mypod         true     511559  511559        0        0   0 /etc/ld.so.cache         ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/g… ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/g… ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/t… ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/t… ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/t… ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/t… ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/x… ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/x… ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/x… ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         true     511559  511559        0        0   0 /lib/x86_64-linux-gnu/l… ------… miniku… ENOEN 2024-07-29T21:…
...
default       mypod         mypod         whoami   511560  511560        0        0   0 /lib/x86_64/libm.so.6    ------… miniku… ENOEN 2024-07-29T21:…
default       mypod         mypod         whoami   511560  511560        0        0   3 /lib/libm.so.6           ------… miniku…       2024-07-29T21:…
default       mypod         mypod         whoami   511560  511560        0        0   3 /lib/libresolv.so.2      ------… miniku…       2024-07-29T21:…
default       mypod         mypod         whoami   511560  511560        0        0   3 /lib/libc.so.6           ------… miniku…       2024-07-29T21:…
default       mypod         mypod         whoami   511560  511560        0        0   3 /etc/passwd              ------… miniku…       2024-07-29T21:
^C
```

Seems the whoami command opens "/etc/passwd" to map the user ID to a user name.
We can stop the gadget by hitting Ctrl-C.

  </TabItem>

  <TabItem value="ig" label="ig">
```bash
$ sudo ig run trace_open:latest --containername test-trace-open
WARN[0000] Ignoring runtime "cri-o" with non-existent socketPath "/run/crio/crio.sock"
WARN[0000] Ignoring runtime "podman" with non-existent socketPath "/run/podman/podman.sock"
RUNTIME.CONTAINERNA… COMM                PID         TID         UID        GID  FD FNAME                    MODE       ERROR   TIMESTAMP
test-trace-open      true             515458      515458           0          0   0 /etc/ld.so.cache         ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      true             515458      515458           0          0   0 /lib/x86_64-linux-gnu/g… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      true             515458      515458           0          0   0 /lib/x86_64-linux-gnu/g… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      true             515458      515458           0          0   0 /lib/x86_64-linux-gnu/t… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      true             515458      515458           0          0   0 /lib/x86_64-linux-gnu/t… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      true             515458      515458           0          0   0 /lib/x86_64-linux-gnu/t… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      true             515458      515458           0          0   0 /lib/x86_64-linux-gnu/t… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      true             515458      515458           0          0   0 /lib/x86_64-linux-gnu/x… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      true             515458      515458           0          0   0 /lib/x86_64-linux-gnu/x… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      true             515458      515458           0          0   0 /lib/x86_64-linux-gnu/x… ---------- ENOENT  2024-07-29T16:53:44.0…
...
test-trace-open      whoami           515459      515459           0          0   0 /lib/tls/x86_64/libm.so… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      whoami           515459      515459           0          0   0 /lib/tls/libm.so.6       ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      whoami           515459      515459           0          0   0 /lib/x86_64/x86_64/libm… ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      whoami           515459      515459           0          0   0 /lib/x86_64/libm.so.6    ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      whoami           515459      515459           0          0   0 /lib/x86_64/libm.so.6    ---------- ENOENT  2024-07-29T16:53:44.0…
test-trace-open      whoami           515459      515459           0          0   3 /lib/libm.so.6           ----------         2024-07-29T16:53:44.0…
test-trace-open      whoami           515459      515459           0          0   3 /lib/libresolv.so.2      ----------         2024-07-29T16:53:44.0…
test-trace-open      whoami           515459      515459           0          0   3 /lib/libc.so.6           ----------         2024-07-29T16:53:44.0…
test-trace-open      whoami           515459      515459           0          0   3 /etc/passwd              ----------         2024-07-29T16:53:44.0…
^C
```
  </TabItem>
</Tabs>

Finally, clean the system:

<Tabs groupId="env">
  <TabItem value="kubectl-gadget" label="kubectl gadget">
```bash
$ kubectl delete pod mypod
```
  </TabItem>

  <TabItem value="ig" label="ig">
```bash
$ docker rm -f test-trace-open
```
  </TabItem>
</Tabs>
