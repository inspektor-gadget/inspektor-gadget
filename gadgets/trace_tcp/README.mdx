---
title: trace_tcp
sidebar_position: 140
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# trace_tcp

The trace_tcp gadget tracks tcp connect, accept and close.

## Getting started

Running the gadget:

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        ```bash
        $ kubectl gadget run ghcr.io/inspektor-gadget/gadget/trace_tcp:latest [flags]
        ```
    </TabItem>

    <TabItem value="ig" label="ig">
        ```bash
        $ sudo ig run ghcr.io/inspektor-gadget/gadget/trace_tcp:latest [flags]
        ```
    </TabItem>
</Tabs>
## Flags

### `--pid`

Show only events generated by processes with this pid. By default events from all pids are traced.

### `--uid`

Show only events generated by processes with this uid. By default events from all uids are traced.

## Guide

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        First, we need to create one pod:

        ```bash
        $ kubectl run bb --image busybox:latest sleep inf
        pod/bb created
        ```

        You can now use the gadget, but output will be empty:

        ```bash
        $ kubectl gadget run trace_tcp:latest
        K8S.NAMESPACE         K8S.PODNAME           K8S.CONTAINERNAME     SRC                          DST                          COMM                PID         TID         UID        GID TYPE       K8S.NODE   TIMESTAMP
        ```

        Indeed, it is waiting for TCP connection to be established in the `default` namespace (you can use `-A` to monitor all namespaces and then be sure to not miss any event).
        So, in *another terminal*, `exec` a container and run this `wget`:

        ```bash
        $ kubectl exec -ti bb -- wget https://www.kinvolk.io
        Connecting to www.kinvolk.io (188.114.96.3:443)
        wget: note: TLS certificate validation not implemented
        saving to 'index.html'
        index.html           100% |************************************************************************************************| 47748  0:00:00 ETA
        'index.html' saved
        ```

        Go back to the terminal where the gadget is running. The requests will be logged by the gadget:

        ```bash
        K8S.NAMESPACE         K8S.PODNAME           K8S.CONTAINERNAME     SRC                          DST                          COMM                PID         TID         UID        GID TYPE       K8S.NODE   TIMESTAMP
        default               bb                    bb                    10.244.0.31:60552            172.67.196.142:443           wget             750625      750625           0          0 connect    minikube-… 2024-08-01T22:57:26.38…
        ```
    </TabItem>

    <TabItem value="ig" label="ig">
        Start the gadget in a terminal:

        ```bash
        $ sudo ig run trace_tcp:latest --containername test-trae-tcp
        RUNTIME.CONTAINERNAME        SRC                                   DST                                   COMM                        PID            TID            UID            GID TYPE           TIMESTAMP
        ```

        Then, run a container that creates a TCP connection.

        ```bash
        $ docker run -it --name test-trace-tcp busybox /bin/sh -c "wget https://www.example.com"
        Connecting to www.example.com (93.184.216.34:443)
        wget: note: TLS certificate validation not implemented
        saving to 'index.html'
        index.html           100% |********************************|  1256  0:00:00 ETA
        'index.html' saved
        ```

        The gadget will print that connection on the first terminal

        ```bash
        $ sudo ig trace tcp -c test-trace-tcp
        RUNTIME.CONTAINERNAME        SRC                                   DST                                   COMM                        PID            TID            UID            GID TYPE           TIMESTAMP
        test-trace-tcp               172.17.0.2:39664                      93.184.215.14:443                     wget                     757178         757178              0              0 connect        2024-08-02T01:03:15.022231308+…
        ```
    </TabItem>
</Tabs>

The printed lines correspond to TCP connection established with the socket.

Congratulations! You reached the end of this guide!
You can now delete the pod you created:

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        ```bash
        $ kubectl delete pod bb
        ```
    </TabItem>

    <TabItem value="ig" label="ig">
        ```bash
        $ docker rm -f test-trace-tcp
        ```
    </TabItem>
</Tabs>
