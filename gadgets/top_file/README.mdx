---
title: top_file
sidebar_position: 40
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# top_file

The top_file gadget reports periodically the read/write activity by file.

## Getting started

Running the gadget:

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        ```bash
        $ kubectl gadget run ghcr.io/inspektor-gadget/gadget/top_file:latest [flags]
        ```
    </TabItem>

    <TabItem value="ig" label="ig">
        ```bash
        $ sudo ig run ghcr.io/inspektor-gadget/gadget/top_file:latest [flags]
        ```
    </TabItem>
</Tabs>

## Flags

TODO: Add flags added by operators.

### `--all-files`

Trace all files types. By default, only regular files are traced

Default value: "false"

### `--pid`

Show only events generated by process with this PID

Default value: "0"

## Guide

This example shows how to use this gadget. To do so, we will run an application
that performs some disk I/O activity.

Before starting our application, let's start our `top_file` gadget to be sure it
captures all the events from the beginning:

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        ```bash
        $ kubectl gadget run top_file:latest --pod mypod
        K8S.NODE     K8S.NAMESPACE          K8S.PODNAME            K8S.CONTAINERNAME               PID  READS RBYT… WRIT… WBYT… FILE                  COMM             T
        ```
    </TabItem>

    <TabItem value="ig" label="ig">
        ```bash
        $ sudo ig run top_file:latest --containername test-top-file
        RUNTIME.CONTAINERNAME                                 PID      READS     RBYTES    WRITES    WBYTES FILE                                COMM             T
        ```
    </TabItem>
</Tabs>

The `T` column indicates the type of the file: `R` for regular files, `S` for
sockets, and `O` for other (including pipes). By default only regular files are
shown; use the `--all-files` option to show all file types.

In another terminal, let's create our application. It'll install `git` and then
clone the linux source code:

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        ```bash
        kubectl run -it mypod --rm --image ubuntu -- /bin/sh -c "apt-get update && apt-get install -y git && git clone https://github.com/torvalds/linux"
        ```
    </TabItem>

    <TabItem value="ig" label="ig">
        ```bash
        docker run --rm --name test-top-file ubuntu /bin/sh -c "apt-get update && apt-get install -y git && git clone https://github.com/torvalds/linux"
        ```
    </TabItem>
</Tabs>

We can see how the `top_file` terminal shows the files that are read and written
by the application. For instance, `apt-get` and `apt-config` are reading a lot
of files when updating the packages list and installing packages:

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        ```bash
		K8S.NODE     K8S.NAMESPACE          K8S.PODNAME            K8S.CONTAINERNAME               PID  READS RBYT… WRIT… WBYT… FILE                  COMM             T
		aks-agentpo… default                mypod                  mypod                        144429      4 16384     0     0 config                http             R
		aks-agentpo… default                mypod                  mypod                        144429      1   832     0     0 libp11-kit.so.0.3.1   http             R
		aks-agentpo… default                mypod                  mypod                        144425      1   832     0     0 liblzma.so.5.4.5      apt-get          R
		aks-agentpo… default                mypod                  mypod                        144425      1   832     0     0 libcap.so.2.66        apt-get          R
		aks-agentpo… default                mypod                  mypod                        144425      3 11889     0     0 01autoremove          apt-get          R
		aks-agentpo… default                mypod                  mypod                        144429      2  8192     0     0 etc-hosts             http             R
		aks-agentpo… default                mypod                  mypod                        144426      1   832     0     0 libmd.so.0.1.0        dpkg             R
		aks-agentpo… default                mypod                  mypod                        144427      1   832     0     0 libunistring.so.5.0.0 http             R
		aks-agentpo… default                mypod                  mypod                        144428      2  8192     0     0 host.conf             http             R
		aks-agentpo… default                mypod                  mypod                        144428      2  8192     0     0 resolv.conf           http             R
		aks-agentpo… default                mypod                  mypod                        144427      1   832     0     0 libgcc_s.so.1         http             R
		aks-agentpo… default                mypod                  mypod                        144428      1  4096     0     0 passwd                http             R
		aks-agentpo… default                mypod                  mypod                        144425      3 12244     0     0 docker-autoremove-su… apt-get          R
        ...
        ```
    </TabItem>

    <TabItem value="ig" label="ig">
        ```bash
		RUNTIME.CONTAINERNAME                                 PID      READS     RBYTES    WRITES    WBYTES FILE                                COMM             T
		test-top-file                                      384616          2      16382         0         0 tupletable                          apt-config       R
		test-top-file                                      384552          1      65536        51    331072 archive.ubuntu.com_ubuntu_dists_no… http             R
		test-top-file                                      384612          1        832         0         0 liblzma.so.5.4.5                    store            R
		test-top-file                                      384550          4      16384         0         0 config                              http             R
		test-top-file                                      384644          1        832         0         0 libstdc++.so.6.0.33                 apt-config       R
		test-top-file                                      384648          3      11970         0         0 docker-clean                        apt-config       R
		test-top-file                                      384560          1        832         0         0 libgcc_s.so.1                       apt-config       R
		test-top-file                                      384646          1        832         0         0 libzstd.so.1.5.5                    apt-config       R
		test-top-file                                      384622          3      12106         0         0 70debconf                           apt-config       R
		test-top-file                                      384654          2       2048         0         0 filesystems                         dpkg             R
		test-top-file                                      384591          1        832         0         0 libselinux.so.1                     dpkg             R
		test-top-file                                      384618          1        832         0         0 libcap.so.2.66                      apt-config       R
		test-top-file                                      384553          1        832         0         0 libz.so.1.3                         gpgv             R
		test-top-file                                      384620          2      16382         0         0 tupletable                          apt-config       R
		test-top-file                                      384648          1        832         0         0 liblzma.so.5.4.5                    apt-config       R
		test-top-file                                      384559          2       8192         0         0 dpkg.cfg                            dpkg             R
        test-top-file                                      384548          3      12244         0         0 docker-autoremove-suggests          apt-get          R
        ...
        ```
    </TabItem>
</Tabs>

After the initial installation is done, we can see how git uses a temporary file
to store the repository being cloned.

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        ```bash
		K8S.NODE     K8S.NAMESPACE          K8S.PODNAME            K8S.CONTAINERNAME               PID  READS RBYT… WRIT… WBYT… FILE                  COMM             T
		aks-agentpo… default                mypod                  mypod                        178405      0     0  5495 2250… tmp_pack_rodQNc       git              R
	    ```
    </TabItem>

    <TabItem value="ig" label="ig">
        ```bash
        RUNTIME.CONTAINERNAME                                 PID      READS     RBYTES    WRITES    WBYTES FILE                                COMM             T
        test-top-file                                      362072          0          0      5832  23887872 tmp_pack_xWFcvD                     git              R
        ```
    </TabItem>
</Tabs>

By default the `top_file` gadget prints a summary each second until users press
Ctrl + C. Both the number of summaries and the interval can be customized using
`--map-fetch-count` and `--map-fetch-interval` flags, respectively. For example,
with the following values, the gadget will run for 10 seconds in total, printing
5 summaries every 2 seconds:

<Tabs groupId="env">
    <TabItem value="kubectl-gadget" label="kubectl gadget">
        ```bash
        kubectl gadget run top_file:latest --map-fetch-count 5 --map-fetch-interval 2s
        ```
    </TabItem>

    <TabItem value="ig" label="ig">
        ```bash
        sudo ig run top_file:latest --map-fetch-count 5 --map-fetch-interval 2s
        ```
    </TabItem>
</Tabs>
